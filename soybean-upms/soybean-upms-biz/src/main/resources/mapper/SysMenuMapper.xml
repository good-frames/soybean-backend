<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.soybean.upms.mapper.SysMenuMapper">

    <resultMap type="com.soybean.upms.api.po.SysMenu" id="SysMenuResult">
        <id     property="menuId"       column="menu_id"      />
        <result property="menuName"     column="menu_name"    />
        <result property="title"        column="title"        />
        <result property="i18nKey"      column="i18n_key"     />
        <result property="parentId"     column="parent_id"    />
        <result property="orderNum"     column="order_num"    />
        <result property="path"         column="path"         />
        <result property="component"     column="component"     />
        <result property="query"        column="query"        />
        <result property="isFrame"      column="is_frame"     />
        <result property="isCache"      column="is_cache"     />
        <result property="menuType"     column="menu_type"    />
        <result property="visible"      column="visible"      />
        <result property="status"       column="status"       />
        <result property="perms"        column="permission"    />
        <result property="icon"         column="icon"         />
        <result property="createBy"     column="create_by"    />
        <result property="createTime"    column="create_time"   />
        <result property="updateBy"     column="update_by"    />
        <result property="updateTime"    column="update_time"   />
        <result property="remark"       column="remark"       />
    </resultMap>

    <sql id="selectMenuVo">
        select distinct menu_id, menu_name, title, i18n_key, parent_id, order_num, path, component, `query`, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark
        from sys_menu
    </sql>


    <select id="selectPermissionsByUserId" parameterType="java.lang.String" resultType="java.lang.String">
        select distinct m.perms
        from sys_menu m
                 left join sys_role_menu rm on m.menu_id = rm.menu_id
                 left join sys_user_role ur on rm.role_id = ur.role_id
        where ur.user_id = #{userId} and m.status = '1'  and m.perms is not null and m.perms != ''
    </select>


    <select id="selectMenuListByUserId" resultType="com.soybean.upms.api.po.SysMenu">
        select distinct m.menu_id, m.parent_id, m.menu_name, m.title, m.i18n_key, m.path, m.component, m.`query`, m.is_frame, m.is_cache, m.menu_type, m.visible, m.status, m.perms, m.icon, m.create_time, m.update_time, m.remark, m.order_num
        from sys_menu m
                 left join sys_role_menu rm on m.menu_id = rm.menu_id
                 left join sys_user_role ur on rm.role_id = ur.role_id
        where ur.user_id = #{userId} and m.status = '1'
        order by m.parent_id, m.order_num
    </select>

    <select id="selectPermsByRoleId">
        select distinct m.perms
        from sys_menu m
                 left join sys_role_menu rm on m.menu_id = rm.menu_id
        where rm.role_id = #{roleId} and m.status = '1' and m.perms is not null and m.perms != ''
    </select>


</mapper>
